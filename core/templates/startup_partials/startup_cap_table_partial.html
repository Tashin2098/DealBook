

{% block content %}
<style>
    .cap-container {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f8f9fa;
        padding: 20px;
        margin: 0;
    }

    .cap-wrapper {
        max-width: 1200px;
        margin: 0 auto;
    }

    .cap-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 24px;
    }

    .cap-grid {
        display: grid;
        grid-template-columns: minmax(400px, 1fr) minmax(400px, 1fr);
        gap: 24px;
        align-items: start;
    }

    .cap-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
        padding: 24px;
        min-width: 0;
    }

    .cap-card h2 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 18px;
    }

    .cap-table {
        width: 100%;
        border-collapse: collapse;
    }

    .cap-table thead {
        background: #f7fafc;
        border-bottom: 1px solid #e2e8f0;
    }

    .cap-table th {
        padding: 14px 18px;
        font-weight: 600;
        font-size: 13px;
        color: #4a5568;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
    }

    .cap-table th:first-child { text-align: left; }
    .cap-table th:last-child { text-align: right; }

    .cap-table td {
        padding: 14px 18px;
        border-bottom: 1px solid #f7fafc;
        font-size: 14px;
        color: #2d3748;
    }

    .cap-table tbody tr:last-child td {
        border-bottom: none;
    }

    .cap-table tbody tr:hover {
        background: #f8f9fa;
        transition: background-color 0.2s ease;
    }

    .cap-table td:nth-child(2),
    .cap-table td:nth-child(3) {
        text-align: right;
        font-weight: 600;
    }

    .cap-chart-container {
        position: relative;
        width: 100%;
        height: 300px;
    }

    /* Responsiveness */
    @media (max-width: 968px) {
        .cap-grid {
            grid-template-columns: 1fr;
        }
        .cap-title {
            font-size: 1.6rem;
        }
    }

    @media (max-width: 600px) {
        .cap-title {
            font-size: 1.3rem;
            margin-bottom: 16px;
        }
        .cap-card {
            padding: 18px;
        }
        .cap-chart-container {
            height: 240px;
        }
    }
</style>

<div class="cap-container">
    <div class="cap-wrapper">
        <h1 class="cap-title">Cap Table</h1>

        <div class="cap-grid">
            

            <!-- TABLE -->
            <div class="cap-card">
                <h2>Ownership Breakdown</h2>
                <table class="cap-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Shares</th>
                            <th>% Ownership</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for owner in cap_table %}
                        <tr>
                            <td>{{ owner.name }}</td>
                            <td>{{ owner.shares }}</td>
                            <td>{{ owner.percent }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- PIE CHART -->
            <div class="cap-card">
                <h2>Equity Ownership</h2>
                <div class="cap-chart-container">
                    <canvas id="capPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function initCapPieChart() {
    const pieCtx = document.getElementById('capPieChart');
    if (!pieCtx) return; // prevent errors if canvas not in DOM
    
    new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: [{% for owner in cap_table %}'{{ owner.name }}',{% endfor %}],
            datasets: [{
                data: [{% for owner in cap_table %}{{ owner.percent }},{% endfor %}],
                backgroundColor: [
                    '#667eea', '#4fd1c7', '#f6e05e', '#fc8181',
                    '#b794f6', '#63b3ed', '#f687b3'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: { font: { size: 12 }, color: '#2d3748' }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    cornerRadius: 8,
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + '%';
                        }
                    }
                }
            }
        }
    });
}

// Run on full page load
document.addEventListener("DOMContentLoaded", initCapPieChart);

// Run when HTMX swaps in this partial
document.body.addEventListener("htmx:afterSwap", function(evt) {
    if (evt.target.querySelector("#capPieChart")) {
        initCapPieChart();
    }
});
</script>

{% endblock %}
