{% load static %}
{% load startup_extras %}

{% block content %}
<style>
/* Modern UI Styles - Scoped to startups content only */
.startups-container {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
    max-width: 1400px;
    margin: 0 auto;
    padding: 32px 24px;
}

.startups-container h2 {
    font-size: 2rem;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 32px 0;
}

.startups-container .search-section {
    margin: 18px 0 30px 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.startups-container .search-input {
    width: 340px;
    font-size: 1rem;
    padding: 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    transition: all 0.2s ease;
    font-family: inherit;
}

.startups-container .search-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.startups-container .search-input::placeholder {
    color: #94a3b8;
}

.startups-container .modern-btn {
    padding: 12px 20px;
    font-size: 0.95rem;
    font-weight: 500;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
}

.startups-container .btn-primary {
    background: #3b82f6;
    color: white;
}

.startups-container .btn-primary:hover {
    background: #2563eb;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.startups-container .btn-secondary {
    background: #ef4444;
    color: white;
}

.startups-container .btn-secondary:hover {
    background: #dc2626;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.startups-container .btn-save {
    background: #10b981;
    color: white;
}

.startups-container .btn-save:hover {
    background: #059669;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.success-message {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1001;
    background: #10b981;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    animation: slideIn 0.3s ease-out;
}

.success-content {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.startups-container .modern-table-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    border: 1px solid #f1f5f9;
}

.startups-container table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: transparent;
}

.startups-container thead {
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}

.startups-container th {
    padding: 16px 20px;
    text-align: left;
    font-weight: 600;
    font-size: 0.85rem;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: none;
}

.startups-container tbody tr {
    border-bottom: 1px solid #f1f5f9;
    transition: background-color 0.2s ease;
}

.startups-container tbody tr:hover {
    background-color: #f8fafc;
}

.startups-container tbody tr:last-child {
    border-bottom: none;
}

.startups-container td {
    padding: 16px 20px;
    vertical-align: top;
    border: none;
}

.startups-container .company-name {
    font-weight: 600;
    color: #0f172a;
    font-size: 0.95rem;
}

.startups-container .contact-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.startups-container .contact-name {
    font-weight: 500;
    color: #0f172a;
    font-size: 0.9rem;
}

.startups-container .contact-email {
    font-size: 0.8rem;
    color: #64748b;
}

.startups-container .modern-btn-view {
    background: #f1f5f9;
    color: #475569;
    padding: 8px 16px;
    font-size: 0.85rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
}

.startups-container .modern-btn-view:hover {
    background: #e2e8f0;
    color: #334155;
}

.startups-container .no-results-modern {
    text-align: center;
    padding: 60px 20px;
    color: #64748b;
    font-size: 1rem;
}

.startups-container .no-results-icon {
    font-size: 3rem;
    margin-bottom: 16px;
    color: #cbd5e1;
}


/* Enhanced Modal Styles */
.modal-details-section {
    background: #f8fafc;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 24px;
    border-left: 4px solid #3b82f6;
}

.modal-section-title {
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-section-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
}

.modal-field-group {
    background: white;
    padding: 16px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.modal-field-group:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.modal-field-label {
    font-weight: 600;
    color: #475569;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
    display: block;
}

.modal-field-value {
    color: #0f172a;
    font-size: 14px;
    word-wrap: break-word;
    line-height: 1.5;
}

.modal-field-value a {
    color: #3b82f6;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s;
}

.modal-field-value a:hover {
    color: #1d4ed8;
    text-decoration: underline;
}

.modal-badge {
    display: inline-block;
    padding: 4px 12px;
    background: #e0e7ff;
    color: #3730a3;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.modal-icon {
    width: 20px;
    height: 20px;
    fill: currentColor;
}

/* Responsive Modal Adjustments */
@media (max-width: 768px) {
    .modal-section-content {
        grid-template-columns: 1fr;
    }
}


</style>

<div class="startups-container">
    <h2>Startups</h2>

    <div class="search-section">
        <input type="text" id="searchInput" placeholder="Search company/name/email" class="search-input">
        <button id="searchButton" onclick="performSearch()" class="modern-btn btn-primary">
            Search
        </button>
        <button id="clearButton" onclick="clearSearch()" class="modern-btn btn-secondary" style="display:none;">
            Clear
        </button>
        <button id="saveButton" onclick="saveChanges()" class="modern-btn btn-save" style="display:none;">
            Save Changes
        </button>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="success-message" style="display:none;">
        <div class="success-content">
            ‚úì Saved changes
        </div>
    </div>

    <div class="modern-table-container">
        <table>
            <thead>
                <tr>
                    <th>Company</th>
                    <th>Contact</th>
                    <th>Approved</th>
                    <th>Onboarded</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody id="startupsTableBody">
                {% for s in startups %}
                <tr class="startup-row" style="border-bottom:1.5px solid #f1f1f5;" 
                    data-company="{{ s.startup_name|lower }}" 
                    data-name="{{ s.user.first_name|lower }}" 
                    data-email="{{ s.user.email|lower }}">
                    <td class="company-name">{{ s.startup_name }}</td>
                    <td>
                        <div class="contact-info">
                            <div class="contact-name">{{ s.user.first_name }}</div>
                            <div class="contact-email">{{ s.user.email }}</div>
                        </div>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox"
                                   data-id="{{ s.id }}"
                                   data-field="is_approved"
                                   {% if s.is_approved %}checked{% endif %}
                                   onchange="toggleStatus(this)">
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td>
                        <label class="switch">
                            <input type="checkbox"
                                   data-id="{{ s.id }}"
                                   data-field="is_onboarded"
                                   {% if s.is_onboarded %}checked{% endif %}
                                   {% if not s.is_approved %}disabled{% endif %}
                                   onchange="toggleStatus(this)">
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td>
                        <button class="modern-btn-view"
                                hx-on:click="openStartupModal({{ s.id }})">
                            View
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="noResultsMessage" class="no-results-modern" style="display:none;">
        <div class="no-results-icon">üîç</div>
        No startups found matching your search criteria.
    </div>
</div>

<!-- Updated switch styling -->
<style>
.switch { 
    position: relative; 
    display: inline-block; 
    width: 44px; 
    height: 24px; 
}

.switch input { 
    opacity: 0; 
    width: 0; 
    height: 0; 
}

.slider {
    position: absolute; 
    cursor: pointer; 
    top: 0; 
    left: 0; 
    right: 0; 
    bottom: 0; 
    background-color: #cbd5e1; 
    border-radius: 24px; 
    transition: .3s;
}

.slider:before {
    position: absolute; 
    content: ""; 
    height: 20px; 
    width: 20px; 
    left: 2px; 
    bottom: 2px; 
    background-color: white; 
    border-radius: 50%;
    transition: .3s; 
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

input:checked + .slider { 
    background-color: #22c55e;
}

input:checked + .slider:before { 
    transform: translateX(20px);
}

input:disabled + .slider {
    background-color: #e2e8f0;
    cursor: not-allowed;
}

input:disabled + .slider:before {
    background-color: #f1f5f9;
}

.startup-row.hidden {
    display: none !important;
}
</style>

<!-- Modal with updated styling -->
<div id="startupModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0, 0, 0, 0.5); z-index:1000; overflow-y:auto; padding:20px; box-sizing:border-box;">
    <div id="startupModalBox" style="max-width:900px; width:100%; margin:40px auto; background:white; border-radius:12px; box-shadow:0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); position:relative; min-height:fit-content;">
        <div style="padding:24px 32px; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center;">
            <h2 style="font-weight:700; margin:0; font-size:1.5rem; color:#0f172a;">Startup Details</h2>
            <button hx-on:click="document.getElementById('startupModal').style.display='none'; document.body.style.overflow='auto';"
                    style="width:32px; height:32px; border:none; background:#f1f5f9; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:18px; color:#64748b; transition:all 0.2s;"
                    onmouseover="this.style.background='#e2e8f0'"
                    onmouseout="this.style.background='#f1f5f9'">&times;</button>
        </div>
        <div id="startupModalContent" style="padding:24px 32px 32px; max-height:calc(90vh - 120px); overflow-y:auto;"></div>
    </div>
</div>

<script>
// Store startup data (keeping original functionality)
const startupData = {
    {% for s in startups %}
    {{ s.id }}: {
        startup_name: "{{ s.startup_name|default_if_none:''|escapejs }}",
        user_first_name: "{{ s.user.first_name|default_if_none:''|escapejs }}",
        user_email: "{{ s.user.email|default_if_none:''|escapejs }}",
        role: "{{ s.role|default_if_none:''|escapejs }}",
        email: "{{ s.email|default_if_none:''|escapejs }}",
        heard_about: "{{ s.heard_about|default_if_none:''|escapejs }}",
        description: "{{ s.description|default_if_none:''|escapejs }}",
        audience: "{{ s.audience|default_if_none:''|escapejs }}",
        tech_component: "{{ s.tech_component|default_if_none:''|escapejs }}",
        your_edge: "{{ s.your_edge|default_if_none:''|escapejs }}",
        pitch_deck_url: "{{ s.pitch_deck_url|default_if_none:''|escapejs }}",
        startup_stage: "{{ s.startup_stage|default_if_none:''|escapejs }}",
        problem: "{{ s.problem|default_if_none:''|escapejs }}",
        solution: "{{ s.solution|default_if_none:''|escapejs }}",
        market_research: "{{ s.market_research|default_if_none:''|escapejs }}",
        business_model_mind: "{{ s.business_model_mind|default_if_none:''|escapejs }}",
        working_time: "{{ s.working_time|default_if_none:''|escapejs }}",
        cofounder: "{{ s.cofounder|default_if_none:''|escapejs }}",
        support_needed: "{{ s.support_needed|default_if_none:''|escapejs }}",
        has_mvp: "{{ s.has_mvp|default_if_none:''|escapejs }}",
        tested_with_customers: "{{ s.tested_with_customers|default_if_none:''|escapejs }}",
        funding_source: "{{ s.funding_source|default_if_none:''|escapejs }}",
        early_users: "{{ s.early_users|default_if_none:''|escapejs }}",
        generated_revenue: "{{ s.generated_revenue|default_if_none:''|escapejs }}",
        stage3_challenges: "{{ s.stage3_challenges|default_if_none:''|escapejs }}",
        stage3_support: "{{ s.stage3_support|default_if_none:''|escapejs }}",
        business_model: "{{ s.business_model|default_if_none:''|escapejs }}",
        paying_customers: "{{ s.paying_customers|default_if_none:''|escapejs }}",
        annual_revenue_4: "{{ s.annual_revenue_4|default_if_none:''|escapejs }}",
        external_funding: "{{ s.external_funding|default_if_none:''|escapejs }}",
        acquisition_strategies: "{{ s.acquisition_strategies|default_if_none:''|escapejs }}",
        team_size: "{{ s.team_size|default_if_none:''|escapejs }}",
        stage4_challenges: "{{ s.stage4_challenges|default_if_none:''|escapejs }}",
        stage4_support: "{{ s.stage4_support|default_if_none:''|escapejs }}",
        annual_revenue_5: "{{ s.annual_revenue_5|default_if_none:''|escapejs }}",
        active_customers_5: "{{ s.active_customers_5|default_if_none:''|escapejs }}",
        markets_operating: "{{ s.markets_operating|default_if_none:''|escapejs }}",
        expansion_plans: "{{ s.expansion_plans|default_if_none:''|escapejs }}",
        stage5_challenges: "{{ s.stage5_challenges|default_if_none:''|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
};

// Track pending changes
let pendingChanges = [];
let hasUnsavedChanges = false;

// Search functionality (keeping original)
function performSearch() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    const rows = document.querySelectorAll('.startup-row');
    const table = document.querySelector('.modern-table-container');
    const noResultsMessage = document.getElementById('noResultsMessage');
    const clearButton = document.getElementById('clearButton');
    
    if (searchTerm === '') {
        rows.forEach(row => row.classList.remove('hidden'));
        table.style.display = 'block';
        noResultsMessage.style.display = 'none';
        clearButton.style.display = 'none';
        return;
    }
    
    let visibleCount = 0;
    
    rows.forEach(row => {
        const company = row.dataset.company || '';
        const name = row.dataset.name || '';
        const email = row.dataset.email || '';
        
        const matches = company.includes(searchTerm) || 
                       name.includes(searchTerm) || 
                       email.includes(searchTerm);
        
        if (matches) {
            row.classList.remove('hidden');
            visibleCount++;
        } else {
            row.classList.add('hidden');
        }
    });
    
    if (visibleCount === 0) {
        table.style.display = 'none';
        noResultsMessage.style.display = 'block';
    } else {
        table.style.display = 'block';
        noResultsMessage.style.display = 'none';
    }
    
    clearButton.style.display = 'inline-block';
}

// Clear search functionality (keeping original)
function clearSearch() {
    document.getElementById('searchInput').value = '';
    const rows = document.querySelectorAll('.startup-row');
    const table = document.querySelector('.modern-table-container');
    const noResultsMessage = document.getElementById('noResultsMessage');
    const clearButton = document.getElementById('clearButton');
    
    rows.forEach(row => row.classList.remove('hidden'));
    table.style.display = 'block';
    noResultsMessage.style.display = 'none';
    clearButton.style.display = 'none';
}

// Add enter key support for search (keeping original)
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performSearch();
    }
});

// Real-time search as user types (keeping original)
document.getElementById('searchInput').addEventListener('input', function() {
    // Uncomment the line below if you want real-time search
    // performSearch();
});

// Toggle status function (updated to track changes)
function toggleStatus(el) {
    // Track the change
    const changeId = `${el.dataset.id}_${el.dataset.field}`;
    const existingIndex = pendingChanges.findIndex(change => change.id === changeId);
    
    const changeData = {
        id: changeId,
        startupId: el.dataset.id,
        field: el.dataset.field,
        value: el.checked
    };
    
    if (existingIndex !== -1) {
        pendingChanges[existingIndex] = changeData;
    } else {
        pendingChanges.push(changeData);
    }
    
    // Show save button
    hasUnsavedChanges = true;
    document.getElementById('saveButton').style.display = 'inline-block';
    
    // Don't make immediate API call anymore - wait for save
}

// New save function
function saveChanges() {
    if (!hasUnsavedChanges || pendingChanges.length === 0) return;
    
    const saveButton = document.getElementById('saveButton');
    const originalText = saveButton.textContent;
    saveButton.textContent = 'Saving...';
    saveButton.disabled = true;
    
    // Process all pending changes
    const promises = pendingChanges.map(change => {
        return fetch("{% url 'toggle_startup_status' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                id: change.startupId,
                field: change.field,
                value: change.value
            })
        }).then(r => r.json());
    });
    
    Promise.all(promises)
        .then(results => {
            const allSuccessful = results.every(data => data.success);
            if (allSuccessful) {
                // Clear pending changes
                pendingChanges = [];
                hasUnsavedChanges = false;
                saveButton.style.display = 'none';
                
                // Show success message and refresh
                showSuccessMessage();
                setTimeout(() => {
                    location.reload();
                }, 500);
            } else {
                alert('Some changes failed to save');
                saveButton.textContent = originalText;
                saveButton.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to save changes');
            saveButton.textContent = originalText;
            saveButton.disabled = false;
        });
}

// Show success message
function showSuccessMessage() {
    const message = document.getElementById('successMessage');
    message.style.display = 'block';
    setTimeout(() => {
        message.style.display = 'none';
    }, 2000);
}

// Modal function with UPDATED styling (keeping original functionality)
function openStartupModal(startupId) {
    const data = startupData[startupId];
    if (!data) { 
        alert('Data not found'); 
        return; 
    }
    
    try {
        let html = `
            <!-- Basic Information Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Basic Information
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Startup Name</label>
                        <div class="modal-field-value">${data.startup_name || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Founder Name</label>
                        <div class="modal-field-value">${data.user_first_name || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Role</label>
                        <div class="modal-field-value">${data.role ? `<span class="modal-badge">${data.role}</span>` : 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Email</label>
                        <div class="modal-field-value">${data.email || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">How heard about us</label>
                        <div class="modal-field-value">${data.heard_about || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Pitch Deck</label>
                        <div class="modal-field-value">${data.pitch_deck_url ? `<a href="${data.pitch_deck_url}" target="_blank">View Pitch Deck</a>` : 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Business Overview Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                    </svg>
                    Business Overview
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Description</label>
                        <div class="modal-field-value">${data.description || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Target Audience</label>
                        <div class="modal-field-value">${data.audience || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Tech Component</label>
                        <div class="modal-field-value">${data.tech_component || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Your Edge</label>
                        <div class="modal-field-value">${data.your_edge || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Startup Stage</label>
                        <div class="modal-field-value">${data.startup_stage ? `<span class="modal-badge">${data.startup_stage}</span>` : 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Problem & Solution Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
                    </svg>
                    Problem & Solution
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Problem</label>
                        <div class="modal-field-value">${data.problem || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Solution</label>
                        <div class="modal-field-value">${data.solution || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Market Research</label>
                        <div class="modal-field-value">${data.market_research || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Business Model</label>
                        <div class="modal-field-value">${data.business_model_mind || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Current Status Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/>
                    </svg>
                    Current Status
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Working Time</label>
                        <div class="modal-field-value">${data.working_time ? `<span class="modal-badge">${data.working_time}</span>` : 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Co-founder</label>
                        <div class="modal-field-value">${data.cofounder || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">MVP Status</label>
                        <div class="modal-field-value">${data.has_mvp || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Customer Testing</label>
                        <div class="modal-field-value">${data.tested_with_customers || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Early Users</label>
                        <div class="modal-field-value">${data.early_users || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Revenue Status</label>
                        <div class="modal-field-value">${data.generated_revenue || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Business Development Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"/>
                    </svg>
                    Business Development
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Business Model</label>
                        <div class="modal-field-value">${data.business_model || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Paying Customers</label>
                        <div class="modal-field-value">${data.paying_customers || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Annual Revenue</label>
                        <div class="modal-field-value">${data.annual_revenue_4 || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">External Funding</label>
                        <div class="modal-field-value">${data.external_funding || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Acquisition Strategies</label>
                        <div class="modal-field-value">${data.acquisition_strategies || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Team Size</label>
                        <div class="modal-field-value">${data.team_size || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Growth & Expansion Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z"/>
                    </svg>
                    Growth & Expansion
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Annual Revenue (Advanced)</label>
                        <div class="modal-field-value">${data.annual_revenue_5 || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Active Customers</label>
                        <div class="modal-field-value">${data.active_customers_5 || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Markets Operating</label>
                        <div class="modal-field-value">${data.markets_operating || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Expansion Plans</label>
                        <div class="modal-field-value">${data.expansion_plans || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Support & Challenges Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z"/>
                    </svg>
                    Support & Challenges
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Support Needed</label>
                        <div class="modal-field-value">${data.support_needed || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Stage 3 Challenges</label>
                        <div class="modal-field-value">${data.stage3_challenges || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Stage 3 Support</label>
                        <div class="modal-field-value">${data.stage3_support || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Stage 4 Challenges</label>
                        <div class="modal-field-value">${data.stage4_challenges || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Stage 4 Support</label>
                        <div class="modal-field-value">${data.stage4_support || 'N/A'}</div>
                    </div>
                    <div class="modal-field-group">
                        <label class="modal-field-label">Stage 5 Challenges</label>
                        <div class="modal-field-value">${data.stage5_challenges || 'N/A'}</div>
                    </div>
                </div>
            </div>

            <!-- Funding Section -->
            <div class="modal-details-section">
                <h3 class="modal-section-title">
                    <svg class="modal-icon" viewBox="0 0 24 24">
                        <path d="M5,6H23V18H5V6M14,9A3,3 0 0,1 17,12A3,3 0 0,1 14,15A3,3 0 0,1 11,12A3,3 0 0,1 14,9M9,8A2,2 0 0,1 7,10V14A2,2 0 0,1 9,16H19A2,2 0 0,1 21,14V10A2,2 0 0,1 19,8H9Z"/>
                    </svg>
                    Funding Information
                </h3>
                <div class="modal-section-content">
                    <div class="modal-field-group">
                        <label class="modal-field-label">Funding Source</label>
                        <div class="modal-field-value">${data.funding_source || 'N/A'}</div>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('startupModalContent').innerHTML = html;
        document.getElementById('startupModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    } catch(e) {
        console.error('Error loading startup details:', e);
        alert('Failed to load details: ' + e.message);
    }
}
</script>
{% endblock %}